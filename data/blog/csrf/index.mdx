---
title: CSRF
categorie: 技术向
date: 2021-03-21 12:23:00
slub: csrf
abstract: 一种挟制用户在当前已登录的 Web 应用程序上执行非本意的操作的攻击方法，换一种说法就是攻击者盗用了你的身份，以你的名义发送恶意请求，从而达到攻击用户的目的。
isPublished: true
tags:
  - HTTP
---
攻击者通过一些技术手段欺骗用户的浏览器去访问一个自己曾经认证过的网站并运行一些操作，由于浏览器曾经认证过，所以被访问的网站会认为是真正的用户操作而去运行。这利用了 web 中用户身份验证的一个漏洞：**HTTP 是无状态的，服务器只能保证请求发自某个用户的浏览器，却不能保证请求本身是用户自愿发出的**。

## 请求过滤
CSRF 漏洞如果被不怀好意者发现会造成很严重的后果，可以使用下面方式对请求过滤：
### cookie
CSRF 攻击之所以能够成功，是因为攻击者可以完全伪造用户的请求，该请求中所有的用户验证信息都是存在于 cookie 中，因此攻击者可以在不知道这些验证信息的情况下直接利用用户自己的 cookie 来通过安全验证。要抵御 CSRF，关键在于不能暴露出用户的 cookie 信息，比较常用的便是使用 `HttpOnly` 禁止客户端读取和修改。
### HTTP Referer
虽然 HTTP 是无状态协议，但其会将当前界面地址传入到后台中，我们可以在`referer`属性获取，只有访问到指定界面，我们才会允许访问，不然拒绝掉此次请求，但是这种方式非常的不灵活，因为后台接口是会提供给多个项目，包括pc端、移动端、微信小程序等调用，所以其路径也基本不会固定，单是如果需要这种效果也还是可以进行 CSRF 拦截的。
```javascript
console.log(ctx.request.headers['referer'])
```
### Tokens
和 `token` 验证方式基本相同，但请求之前我们可以先从服务器获得一个随机 Token，当请求时将其一并传入，服务器校验 Token 是否正确，如果错误，可以则认为是非法的请求，而过滤掉此次请求。

## 结尾
魔高一尺，道高一丈。每一种攻击方式都有着防范的方法，每个防范的方法都有着自己的特点，需要时也可以结合起来进行使用。