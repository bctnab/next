---
title: XSS
categorie: 技术向
date: 2020-12-10 10:35:40
slub: xss
abstract: 最普遍的Web应用安全漏洞，攻击者插入恶意指令代码到网页，使其他用户加载并执行攻击者恶意制造的网页程序。
isPublished: true
tags:
  - HTTP
---
跨站脚本攻击是指恶意攻击者往 Web 页面里插入恶意 Script 代码，当用户浏览该页之时，嵌入其中 Web 里面的 Script 代码会被执行，从而达到恶意攻击用户的目的。

从攻击方式上进行分类，XSS 可以分为三类：
- **反射型XSS**：**<非持久化>** 攻击者事先制作好攻击链接, 需要欺骗用户自己去点击链接触发 XSS 代码。
- **存储型XSS**：**<持久化>** 恶意代码保存至数据库中，比如个人信息、个人文章等信息中，如果没有过滤或过滤不严，那么这些代码将储存到服务器中，每当有用户访问该页面的时候都会触发代码执行，这种XSS非常危险，因为其是永久存在的，会大量盗窃用户 cookie。
- **DOM型XSS**：基于 DOM 对象的一种漏洞，DOM 是用来描述界面节点内容、结构和样式等。攻击者可以通过 DOM 攻击达到重定向用户，劫持浏览器等操作。

## 请求过滤
XSS是一种基础的攻击方式，防御XSS攻击的方式也有很多：
### filter
最简单的就是对传入的内容中不合法信息都进行过滤，从而保证项目中数据的安全性。
比如移除用户输入的 DOM 属性，例如过滤掉 **onclick**、**onerror**、**onload** 等相关的 DOM 事件，并且移除一些用户定义的节点，例如过滤掉 **&lt;style&gt;**、**&lt;script&gt;**、**&lt;iframe&gt;** 等节点。
> 不是所有的 JavaScript 都要在 &lt;script&gt; 中才能执行，放在 onerror、onload 等钩子中都是可以正常执行的，所以一些 DOM 事件也有必要进行过滤。

### HTML Entity
有时不仅需要对于输入或者传入的数据进行过滤，在前端渲染或后台保存的时候，还需要对字符串进行 HTML Entity 的编码处理，因为为了攻击网站，可以使用一些转移的字符如：`"<"` 可以替换为 `&lt;`、`">"` 可以替换为`&gt;` 等字符转码可以绕过一些过滤。
> 并且能绕过匹配的不仅有特殊字符串，如果项目中判断不完全甚至可以用大小写绕过，例如我们这样写：&lt;scRIpt&gt;...&lt;/scRIpt&gt; 是能正常运行的，因为 JavaScript 是不区分大小写的。

### httpOnly
不将信息存储到 web Storage，而存储到 **cookie** 中，并且为 cookie 设置为无法被读写的，为其设置上`httpOnly`，这样之后使用 JS 便不能读写 cookie 数据。
### Limit length
因为需要添加一些可执行的 JS 代码，会是很长的一段代码，所以我们可以限制一些代码的长度，避免出现过长的代码，也可以进行简单的长度限制。

## XSS攻击
道高一尺魔高一丈，项目中有很多避免 XSS 漏洞的方式，但 XSS 的攻击方式也是多种多样。
### 大小写
上面已经介绍过，因为 JavaScript 是一种弱文本语言，并其不区分大小写，所以我们可以利用这点进行攻击，例如添加下面代码：
```html
<scrIPt>alert("hello world")</scrIPt>
```
如果项目判断不谨慎，很容易被该方式偷鸡。
### 利用过滤
一种技巧，因为大部分项目都对 &lt;script&gt; 标签进行了过滤，那么我们便可以利用这一点对齐进行攻击。例如这样做：
```html
<scRi<script>pt>alert("hello world")</scRi</script>pt>
```
虽然这样代码看起来什么也不是，但是经过其过滤掉 &lt;script&gt; 标签后，会出现下面代码：
```html
<scRipt>alert("hello world")</scRipt>
```
正好利用其过滤形成一条可执行语句，也是一种小技巧。
### DOM 事件
我们并不是只有插入 &lt;script&gt;  才能执行 JS 的代码，我们可以使用 DOM标签 绑定事件，事件中可执行 JS 代码。例如我们这样写：
```html
<img src='w.123' onerror='alert("hey!")' />
```
如果输入大意，也是可能对其项目造成危害的。
### 转译符
因为项目都是对指定字符串进行匹配，但是 JS 中有一些特别的转义字符，大部分都是通过 "\" 字符进行转义，而攻击者可以使用转义输入，但是转义之后便是可执行的代码，便能达到攻击项目的目的。
例如这样写：
```html
<script>eval(\u0061\u006c\u0065\u0072\u0074(1))</script>
```
这样转移之后便是：
```html
<script>alert(1)</script>
```
这样也可以绕过一些字符的过滤。
